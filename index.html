<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Speech Calculator</title>
    <link
      rel="icon"
      href="https://cdn.glitch.global/fa7af3ed-595a-4cee-ae5e-c4c3844fc237/microphone-icon-vector-illustration.jpg?v=1749192145610"
      type="image/x-icon"
    />
    <style>
      body {
        font-family: "Arial", sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        margin: 0;
        background: linear-gradient(to bottom, #87ceeb, #1e90ff);
        color: #333;
        overflow: hidden;
        transition: all 0.3s;
      }
      .bubble {
        position: absolute;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        animation: float 15s infinite ease-in-out;
        z-index: -1;
      }
      @keyframes float {
        0% {
          transform: translateY(0) rotate(0deg);
          opacity: 1;
        }
        100% {
          transform: translateY(-1000px) rotate(720deg);
          opacity: 0;
        }
      }
      .calculator {
        background-color: rgba(255, 255, 255, 0.9);
        border-radius: 15px;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        padding: 30px;
        width: 350px;
        text-align: center;
        position: relative;
        overflow: hidden;
        border: 2px solid #1e90ff;
        transition: all 0.3s;
      }
      h1 {
        color: #2c3e50;
        margin-bottom: 20px;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        transition: all 0.3s;
      }
      .fish-icon {
        font-size: 40px;
        margin-bottom: 15px;
      }
      .display {
        background-color: #ecf0f1;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 20px;
        min-height: 60px;
        font-size: 18px;
        text-align: right;
        word-wrap: break-word;
        border: 1px solid #bdc3c7;
        transition: all 0.3s;
      }
      .status {
        margin: 15px 0;
        font-style: italic;
        color: #7f8c8d;
        min-height: 20px;
      }
      button {
        background-color: #3498db;
        color: white;
        border: none;
        border-radius: 8px;
        padding: 12px 25px;
        font-size: 16px;
        cursor: pointer;
        margin: 5px;
        transition: all 0.3s;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }
      button:hover {
        background-color: #2980b9;
        transform: translateY(-2px);
      }
      button:disabled {
        background-color: #bdc3c7;
        cursor: not-allowed;
        transform: none;
      }
      .response {
        margin-top: 20px;
        padding: 15px;
        border-radius: 8px;
        background-color: #e8f4f8;
        min-height: 20px;
        border: 1px dashed #3498db;
        transition: all 0.3s;
      }
      .water-effect {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="rgba(255,255,255,0.2)" d="M0,192L48,197.3C96,203,192,213,288,229.3C384,245,480,267,576,250.7C672,235,768,181,864,181.3C960,181,1056,235,1152,234.7C1248,235,1344,181,1392,154.7L1440,128L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>');
        background-repeat: no-repeat;
        background-position: bottom;
        background-size: cover;
        opacity: 0.5;
        z-index: -1;
        animation: wave 10s infinite linear;
      }
      @keyframes wave {
        0% {
          background-position-x: 0;
        }
        100% {
          background-position-x: 1000px;
        }
      }
      .language-selector {
        margin-bottom: 20px;
      }
      .language-selector button {
        padding: 8px 15px;
        background-color: #2ecc71;
      }
      .language-selector button.active {
        background-color: #27ae60;
        font-weight: bold;
      }
      .floating-button {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background-color: #e74c3c;
        color: white;
        border: none;
        border-radius: 50px;
        padding: 10px 20px;
        font-size: 14px;
        cursor: pointer;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        z-index: 1000;
      }
      .floating-button:hover {
        background-color: #c0392b;
      }
      .dark-mode {
        background: linear-gradient(to bottom, #2c3e50, #34495e) !important;
        color: #ecf0f1 !important;
      }
      .dark-mode .calculator {
        background-color: rgba(52, 73, 94, 0.9) !important;
        color: #ecf0f1 !important;
        border-color: #3498db !important;
      }
      .dark-mode .display,
      .dark-mode .response {
        background-color: #2c3e50 !important;
        color: #ecf0f1 !important;
        border-color: #3498db !important;
      }
      .dark-mode h1 {
        color: #ecf0f1 !important;
      }
      .dark-mode-toggle {
        position: fixed;
        top: 20px;
        right: 20px;
        background: #34495e;
        color: white;
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        font-size: 20px;
        cursor: pointer;
        z-index: 1000;
        display: flex;
        align-items: center;
        justify-content: center;
      }
    </style>
  </head>
  <body>
    <div id="bubbles"></div>
    <button class="dark-mode-toggle" id="darkModeToggle">üåô</button>
    <div class="calculator">
      <div class="water-effect"></div>
      <div class="fish-icon">üì±</div>
      <h1 id="app-title">Speech Calculator</h1>
      <div class="language-selector">
        <button id="lang-en" class="active">English</button>
        <button id="lang-cn">‰∏≠Êñá</button>
      </div>
      <div class="display" id="display">
        Say "melon" then ask:<br />"What is 20 + 30?"
      </div>
      <div class="status" id="status">
        Microphone: Listening for wake word...
      </div>
      <div class="response" id="response"></div>
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const display = document.getElementById("display");
        const status = document.getElementById("status");
        const response = document.getElementById("response");
        const bubblesContainer = document.getElementById("bubbles");
        const appTitle = document.getElementById("app-title");
        const langEnBtn = document.getElementById("lang-en");
        const langCnBtn = document.getElementById("lang-cn");
        const darkModeToggle = document.getElementById("darkModeToggle");
        const languages = {
          en: {
            title: "Speech Calculator",
            displayPrompt: 'Say "melon" then ask:<br>"What is 20 + 30?"',
            statusListening: "Microphone: Listening for wake word...",
            statusActive: "Microphone: Active - Ready for commands",
            statusError: "Error: ",
            wakeWord: "melon",
            calculationPrompt: [
              "what is",
              "calculate",
              "how much",
              "+",
              "-",
              "√ó",
              "√∑",
              "add",
              "subtract",
              "multiply",
              "divide",
              "plus",
              "minus",
              "times",
            ],
            examplePrompt: "Ask me to calculate.",
            needNumbers: "I need numbers to calculate.",
            numbersOnly: "Please provide numbers to calculate.",
          },
          cn: {
            title: "ËØ≠Èü≥ËÆ°ÁÆóÂô®",
            displayPrompt: 'ËØ¥ "Â∞èÁìú" ÁÑ∂ÂêéÊèêÈóÆ:<br>"20Âä†30Á≠â‰∫éÂ§öÂ∞ëÔºü"',
            statusListening: "È∫¶ÂÖãÈ£é: Ê≠£Âú®ÁõëÂê¨Âî§ÈÜíËØç...",
            statusActive: "È∫¶ÂÖãÈ£é: ÊøÄÊ¥ªÁä∂ÊÄÅ - ÂáÜÂ§áËÆ°ÁÆó",
            statusError: "ÈîôËØØ: ",
            wakeWord: "Â∞èÁìú",
            calculationPrompt: [
              "Â§öÂ∞ë",
              "ËÆ°ÁÆó",
              "Âä†",
              "Âáè",
              "‰πò",
              "Èô§",
              "Á≠â‰∫é",
              "Âá†",
            ],
            examplePrompt: "ËØ∑ËÆ©ÊàëËÆ°ÁÆó„ÄÇ",
            needNumbers: "ÊàëÈúÄË¶ÅÊï∞Â≠óÊù•ËÆ°ÁÆó„ÄÇ",
            numbersOnly: "ËØ∑Êèê‰æõÊï∞Â≠óÊù•ËÆ°ÁÆó„ÄÇ",
          },
        };
        let currentLang = "en";
        let isDarkMode = false;
        let recognition = null;
        let isListening = false;
        let wakeWordDetected = false;
        function setLanguage(lang) {
          currentLang = lang;
          const langData = languages[lang];
          appTitle.textContent = langData.title;
          display.innerHTML = langData.displayPrompt;
          status.textContent = langData.statusListening;
          langEnBtn.classList.remove("active");
          langCnBtn.classList.remove("active");
          document.getElementById(`lang-${lang}`).classList.add("active");
          if (recognition) {
            try {
              recognition.stop();
            } catch (e) {}
            recognition.lang = lang === "en" ? "en-US" : "zh-CN";
            setTimeout(() => {
              try {
                recognition.start();
              } catch (e) {}
            }, 400);
          }
        }
        darkModeToggle.addEventListener("click", () => {
          isDarkMode = !isDarkMode;
          document.body.classList.toggle("dark-mode", isDarkMode);
          darkModeToggle.textContent = isDarkMode ? "‚òÄÔ∏è" : "üåô";
        });
        langEnBtn.addEventListener("click", () => setLanguage("en"));
        langCnBtn.addEventListener("click", () => setLanguage("cn"));
        for (let i = 0; i < 20; i++) createBubble();
        function createBubble() {
          const bubble = document.createElement("div");
          bubble.className = "bubble";
          const size = Math.random() * 60 + 20;
          bubble.style.width = `${size}px`;
          bubble.style.height = `${size}px`;
          bubble.style.left = `${Math.random() * 100}%`;
          bubble.style.bottom = `-${size}px`;
          bubble.style.animationDuration = `${Math.random() * 20 + 10}s`;
          bubble.style.animationDelay = `${Math.random() * 5}s`;
          bubblesContainer.appendChild(bubble);
          setTimeout(() => {
            bubble.remove();
            createBubble();
          }, 15000);
        }
        if (
          !("webkitSpeechRecognition" in window) &&
          !("SpeechRecognition" in window)
        ) {
          status.textContent =
            "Speech recognition not supported in this browser.";
        } else {
          const SpeechRecognition =
            window.SpeechRecognition || window.webkitSpeechRecognition;
          recognition = new SpeechRecognition();
          recognition.continuous = true;
          recognition.interimResults = true;
          recognition.lang = "en-US";
          recognition.onstart = function () {
            status.textContent = languages[currentLang].statusListening;
            isListening = true;
          };
          recognition.onend = function () {
            if (isListening) {
              try {
                recognition.start();
              } catch (e) {}
            }
          };
          recognition.onerror = function (event) {
            status.textContent =
              languages[currentLang].statusError + (event.error || "unknown");
            isListening = false;
            setTimeout(() => {
              try {
                recognition.start();
              } catch (e) {}
            }, 5000);
          };
          recognition.onresult = function (event) {
            let interimTranscript = "";
            let finalTranscript = "";
            for (let i = event.resultIndex; i < event.results.length; i++) {
              const transcript = event.results[i][0].transcript;
              if (event.results[i].isFinal) finalTranscript += transcript;
              else interimTranscript += transcript;
            }
            const transcriptToProcess = (
              finalTranscript || interimTranscript
            ).trim();
            if (transcriptToProcess) {
              display.textContent = transcriptToProcess;
              processSpeech(transcriptToProcess.toLowerCase());
            }
          };
          try {
            recognition.start();
          } catch (e) {
            status.textContent = languages[currentLang].statusError + e.message;
            setTimeout(() => {
              try {
                recognition.start();
              } catch {}
            }, 5000);
          }
        }
        function processSpeech(text) {
          const langData = languages[currentLang];
          if (
            !wakeWordDetected &&
            text.includes(langData.wakeWord.toLowerCase())
          ) {
            wakeWordDetected = true;
            status.textContent = langData.statusActive;
            speak(
              currentLang === "en" ? "Ready for your command" : "ËØ∑ËØ¥Âá∫ÊÇ®ÁöÑÊåá‰ª§"
            );
            return;
          }
          if (!wakeWordDetected) return;
          const calculation = calculateAdvanced(text);
          if (calculation) {
            const spoken =
              currentLang === "en"
                ? `${calculation.expression} equals ${calculation.result}`
                : `${calculation.expression} Á≠â‰∫é ${calculation.result}`;
            speak(spoken);
            showResult(calculation.expression, calculation.result);
          } else {
            speak(langData.examplePrompt);
            response.innerHTML = `<em>${langData.examplePrompt}</em>`;
          }
          setTimeout(() => {
            wakeWordDetected = false;
            status.textContent = languages[currentLang].statusListening;
          }, 4000);
        }
        function calculateAdvanced(text) {
          const langData = languages[currentLang];
          let result = null;
          let expression = "";

          text = text.replace(/,/g, "");

          const numberRegex = /[+-]?\d+(\.\d+)?/g;
          const numbers = text.match(numberRegex) || [];
          const num1 = numbers[0] !== undefined ? parseFloat(numbers[0]) : null;
          const num2 = numbers[1] !== undefined ? parseFloat(numbers[1]) : null;
          const has = (arr) => arr.some((op) => text.includes(op));
          if (
            (text.includes("sqrt") ||
              text.includes("square root") ||
              text.includes("Âπ≥ÊñπÊ†π")) &&
            num1 !== null
          ) {
            result = Math.sqrt(num1);
            expression = `‚àö${num1}`;
          } else if (
            (text.includes("power") ||
              text.includes("^") ||
              text.includes("Ê¨°Êñπ")) &&
            num1 !== null &&
            num2 !== null
          ) {
            result = Math.pow(num1, num2);
            expression = `${num1}^${num2}`;
          } else if (text.includes("%") && num1 !== null && num2 !== null) {
            result = (num1 * num2) / 100;
            expression = `${num1}% of ${num2}`;
          } else if (
            num1 !== null &&
            num2 !== null &&
            has(langData.calculationPrompt)
          ) {
            if (
              text.includes("+") ||
              text.includes("add") ||
              text.includes("plus") ||
              text.includes("Âä†")
            ) {
              result = num1 + num2;
              expression = `${num1} + ${num2}`;
            } else if (
              text.includes("-") ||
              text.includes("minus") ||
              text.includes("subtract") ||
              text.includes("Âáè")
            ) {
              result = num1 - num2;
              expression = `${num1} - ${num2}`;
            } else if (
              text.includes("√ó") ||
              text.includes("x") ||
              text.includes("times") ||
              text.includes("multiply") ||
              text.includes("‰πò")
            ) {
              result = num1 * num2;
              expression = `${num1} √ó ${num2}`;
            } else if (
              text.includes("√∑") ||
              text.includes("/") ||
              text.includes("divide") ||
              text.includes("Èô§")
            ) {
              if (num2 === 0) {
                return {
                  expression: `${num1} √∑ ${num2}`,
                  result: currentLang === "en" ? "undefined" : "Êú™ÂÆö‰πâ",
                };
              }
              result = num1 / num2;
              expression = `${num1} √∑ ${num2}`;
            }
          }
          if (result !== null && !isNaN(result)) {
            return {
              expression: expression,
              result: Number.isInteger(result)
                ? result
                : parseFloat(result.toFixed(6)),
            };
          }
          return null;
        }
        function showResult(expression, resultVal) {
          response.innerHTML = `<strong>${
            currentLang === "en" ? "Result:" : "ÁªìÊûú:"
          }</strong> ${expression} = <strong>${resultVal}</strong>`;
          setTimeout(() => {
            response.innerHTML +=
              '<div style="font-size:24px;margin-top:10px;">üéâ ü•≥ üëè</div>';
          }, 800);
        }
        function speak(text) {
          try {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = currentLang === "en" ? "en-GB" : "zh-CN";
            utterance.rate = 0.95;
            utterance.pitch = 1.0;
            window.speechSynthesis.cancel();
            window.speechSynthesis.speak(utterance);
          } catch (e) {}
        }
      });
    </script>
  </body>
</html>
